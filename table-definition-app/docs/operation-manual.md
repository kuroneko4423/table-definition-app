# 操作マニュアル

## 1. はじめに

### 1.1 システム概要
テーブル定義管理システムは、データベースのテーブル定義をプロジェクト単位で管理し、ドキュメント化を支援するWebアプリケーションです。

### 1.2 主な機能
- プロジェクト管理（作成・編集・削除）
- プロジェクト単位でのテーブル管理
- テーブル定義の作成・編集・削除
- カラム定義の詳細設定（データ型、制約、順序等）
- Excel/Markdown/DDL形式でのエクスポート
- 日本語対応の多言語対応
- 環境別データベース対応（H2/PostgreSQL）

## 2. アクセス方法

### 2.1 URLアクセス
1. Webブラウザを起動します
2. アドレスバーに以下のURLを入力します
   - 開発環境: `http://localhost:8080`
   - 本番環境: システム管理者から提供されたURL

### 2.2 推奨ブラウザ
- Google Chrome（最新版）
- Mozilla Firefox（最新版）
- Microsoft Edge（最新版）
- Safari（最新版）

## 3. プロジェクト管理

### 3.1 プロジェクト一覧の表示
1. アプリケーションにアクセスすると、プロジェクト一覧が表示されます
2. 各プロジェクトには以下の情報が表示されます：
   - プロジェクトコード
   - プロジェクト名
   - 説明
   - テーブル数
   - 作成日時
   - 更新日時

### 3.2 新規プロジェクトの作成
1. プロジェクト一覧画面で「新規プロジェクト作成」ボタンをクリック
2. 以下の情報を入力：
   - **プロジェクトコード**（必須）: 英数字、ハイフン、アンダースコアのみ（最大50文字）
   - **プロジェクト名**（必須）: プロジェクトの名前（最大100文字）
   - **説明**（任意）: プロジェクトの詳細説明（最大500文字）
3. 「保存」ボタンをクリック
4. 保存成功後、プロジェクト一覧画面に戻り、「プロジェクトを作成しました。」メッセージが表示されます

### 3.3 プロジェクトの編集
1. プロジェクト一覧で編集したいプロジェクトの「編集」ボタンをクリック
2. 必要な情報を修正
3. 「保存」ボタンをクリック
4. 保存成功後、「プロジェクトを更新しました。」メッセージが表示されます

### 3.4 プロジェクトの削除
1. プロジェクト一覧で削除したいプロジェクトの「削除」ボタンをクリック
2. 確認ダイアログで「削除」をクリック
   - **注意**: プロジェクトを削除すると、関連するすべてのテーブル定義とカラム定義も削除されます（CASCADE削除）

## 4. テーブル定義管理

### 4.1 テーブル一覧の表示
1. プロジェクト一覧から対象プロジェクトの「テーブル管理」ボタンをクリック、またはプロジェクト名をクリック
2. 選択したプロジェクト内のテーブル一覧が表示されます
3. パンくずリストでナビゲーション状況を確認できます

### 4.2 新規テーブルの作成
1. テーブル一覧画面で「テーブル新規作成」ボタンをクリック
2. テーブル情報を入力：
   - **スキーマ名**（任意）: データベーススキーマ名
   - **物理名**（必須）: テーブルの物理名（英字で開始、英数字とアンダースコアのみ）
   - **論理名**（必須）: テーブルの論理名（日本語可）
   - **説明**（任意）: テーブルの詳細説明

### 4.3 カラム定義の追加
1. テーブル作成/編集画面で「カラム追加」ボタンをクリック
2. カラム情報を入力：
   - **物理名**（必須）: カラムの物理名（英字で開始、英数字とアンダースコアのみ）
   - **論理名**（必須）: カラムの論理名（日本語可）
   - **データ型**（必須）: プルダウンから選択
   - **長さ**（任意）: データの最大長（0以上）
   - **精度**（任意）: 数値の精度（0以上）
   - **スケール**（任意）: 小数点以下の桁数（0以上）
   - **NULL許可**: チェックでNULL値を許可（デフォルト: ON）
   - **プライマリキー**: PKとして設定（デフォルト: OFF）
   - **ユニークキー**: UKとして設定（デフォルト: OFF）
   - **デフォルト値**（任意）: 初期値
   - **説明**（任意）: カラムの説明
   - **カラム順序**（必須）: 表示順序（1以上の整数）

### 4.4 サポートするデータ型
- **文字列系**: VARCHAR, CHAR, TEXT, CLOB
- **数値系**: INTEGER, BIGINT, DECIMAL, NUMERIC, FLOAT, DOUBLE
- **日時系**: DATE, TIME, TIMESTAMP
- **その他**: BOOLEAN, BINARY, VARBINARY, BLOB, JSON, XML

### 4.5 カラムの削除
1. 削除したいカラムの行末にある「×」ボタンをクリック
2. カラムが即座に削除されます（確認なし）

### 4.6 テーブルの保存
1. すべての必須項目を入力
2. 「保存」ボタンをクリック
3. エラーがある場合は、該当箇所にエラーメッセージが表示されます
4. 保存成功後、テーブル一覧画面に戻ります

### 4.7 テーブルの編集
1. テーブル一覧で編集したいテーブルの「編集」ボタンをクリック
2. テーブル情報やカラム定義を修正
3. 「保存」ボタンをクリック

### 4.8 テーブルの削除
1. テーブル一覧で削除したいテーブルの「削除」ボタンをクリック
2. 確認ダイアログで「削除」をクリック
   - **注意**: テーブルを削除すると、関連するすべてのカラム定義も削除されます

## 5. エクスポート機能

### 5.1 エクスポート対象の選択
1. テーブル一覧画面で、エクスポートしたいテーブルのラジオボタンを選択
2. 一度に選択できるのは1つのテーブルのみ
3. テーブルを選択しないでエクスポートボタンを押すとアラートが表示されます

### 5.2 Excel形式でのエクスポート
1. テーブルを選択後、「Excel出力」ボタンをクリック
2. Excel形式（.xlsx）でダウンロードされます
3. ファイル名: `table_definitions_YYYYMMDD_HHmmss.xlsx`
4. ファイル内容: テーブル定義とカラム定義の詳細情報

### 5.3 Markdown形式でのエクスポート
1. テーブルを選択後、「Markdown出力」ボタンをクリック
2. Markdown形式（.md）でダウンロードされます
3. ファイル名: `table_definitions_YYYYMMDD_HHmmss.md`
4. ファイル内容: 表形式のテーブル定義書

### 5.4 DDL形式でのエクスポート
1. テーブルを選択後、「DDL出力」ボタンをクリック
2. SQL DDL形式（.sql）でダウンロードされます
3. ファイル名: `table_definitions_YYYYMMDD_HHmmss.sql`
4. ファイル内容: CREATE TABLE文とカラム定義

## 6. 画面説明

### 6.1 プロジェクト一覧画面
```
┌─────────────────────────────────────────┐
│ テーブル定義書管理システム                │
├─────────────────────────────────────────┤
│ プロジェクト一覧                          │
│                                         │
│ [新規プロジェクト作成]                    │
│                                         │
│ ┌───────┬────────┬────┬──────┬─────┐   │
│ │コード  │名前     │テーブル│作成日 │操作  │   │
│ ├───────┼────────┼────┼──────┼─────┤   │
│ │PROJ001│サンプル │3     │10/1  │[テーブル管理]│
│ │       │プロジェクト│     │      │[編集]│   │
│ │       │        │     │      │[削除]│   │
│ └───────┴────────┴────┴──────┴─────┘   │
└─────────────────────────────────────────┘
```

### 6.2 テーブル一覧画面
```
┌─────────────────────────────────────────┐
│ テーブル定義書管理システム                │
├─────────────────────────────────────────┤
│ プロジェクト一覧 > PROJ001                │
│                                         │
│ PROJ001 - テーブル一覧                   │
│                                         │
│ [テーブル新規作成]  [Excel出力]          │
│                    [Markdown出力]       │
│                    [DDL出力]            │
│                                         │
│ ┌──┬────────┬────────┬──────┬─────┐   │
│ │◯│物理名   │論理名   │説明   │操作  │   │
│ ├──┼────────┼────────┼──────┼─────┤   │
│ │◯│users   │ユーザー │ユーザ │[編集]│   │
│ │  │        │テーブル │マスタ │[削除]│   │
│ └──┴────────┴────────┴──────┴─────┘   │
└─────────────────────────────────────────┘
```

### 6.3 テーブル作成/編集画面
```
┌─────────────────────────────────────────┐
│ テーブル定義書管理システム                │
├─────────────────────────────────────────┤
│ プロジェクト一覧 > PROJ001 > テーブル作成  │
│                                         │
│ テーブル情報                             │
│ スキーマ名: [          ]                 │
│ 物理名*:   [          ]                 │
│ 論理名*:   [          ]                 │
│ 説明:      [          ]                 │
│                                         │
│ カラム定義                               │
│ [カラムを追加]                           │
│ ┌────────┬────────┬──────┬───┬───┐   │
│ │物理名* │論理名*  │データ型│順序│PK │   │
│ ├────────┼────────┼──────┼───┼───┤   │
│ │id      │ID      │BIGINT│1  │☑ │[×]│
│ │name    │名前    │VARCHAR│2  │☐ │[×]│
│ └────────┴────────┴──────┴───┴───┘   │
│                                         │
│ [戻る] [保存]                            │
└─────────────────────────────────────────┘
```

## 7. バリデーション・制約

### 7.1 プロジェクト
- **プロジェクトコード**: 必須、英数字・ハイフン・アンダースコアのみ、最大50文字、重複不可
- **プロジェクト名**: 必須、最大100文字
- **説明**: 任意、最大500文字

### 7.2 テーブル定義
- **物理名**: 必須、英字で開始、英数字とアンダースコアのみ、プロジェクト内で重複不可
- **論理名**: 必須

### 7.3 カラム定義
- **物理名**: 必須、英字で開始、英数字とアンダースコアのみ、テーブル内で重複不可
- **論理名**: 必須
- **データ型**: 必須
- **長さ・精度・スケール**: 0以上の整数
- **カラム順序**: 必須、1以上の整数

## 8. 注意事項

### 8.1 データの保存
- ブラウザの「戻る」ボタンを使用すると、入力内容が失われる可能性があります
- 必ず画面内の「戻る」「保存」ボタンを使用してください

### 8.2 削除操作
- 削除操作は取り消せません
- プロジェクト削除時は関連するすべてのテーブル・カラム定義が削除されます
- テーブル削除時は関連するすべてのカラム定義が削除されます

### 8.3 プライマリキー設定
- プライマリキーを設定すると、自動的にNULL許可のチェックが外れます
- 複数のカラムにプライマリキーを設定できます（複合キー）

### 8.4 物理名の命名規則
- テーブル物理名・カラム物理名は英字で開始する必要があります
- 英数字とアンダースコアのみ使用可能です
- プロジェクト内でテーブル物理名の重複は不可
- テーブル内でカラム物理名の重複は不可

### 8.5 エクスポート
- エクスポート前に必ずテーブルを選択してください
- 選択していない場合はアラートメッセージが表示されます

## 9. トラブルシューティング

### 9.1 画面が表示されない
- URLが正しいか確認してください
- ネットワーク接続を確認してください
- ブラウザのキャッシュをクリアしてください
- アプリケーションサーバーが起動しているか確認してください

### 9.2 保存できない
- 必須項目（*印）がすべて入力されているか確認してください
- 重複するプロジェクトコード・テーブル物理名・カラム物理名がないか確認してください
- 物理名が英字で開始しているか確認してください
- カラム順序が1以上の整数になっているか確認してください

### 9.3 エクスポートできない
- テーブルが選択されているか確認してください
- ブラウザのポップアップブロックを無効にしてください
- ファイルのダウンロード設定を確認してください

### 9.4 文字化けする
- ブラウザの文字エンコーディングがUTF-8になっているか確認してください
- エクスポートファイルをUTF-8対応のアプリケーションで開いてください

### 9.5 メッセージが表示されない
- ブラウザのキャッシュをクリアしてください
- 日本語メッセージファイルが正しく配置されているか確認してください

## 10. よくある質問（FAQ）

**Q1: 一度削除したデータを復元できますか？**
A: いいえ、削除したデータは復元できません。削除前に必要に応じてエクスポートしてバックアップを取ってください。

**Q2: 複数のテーブルを一度にエクスポートできますか？**
A: 現在のバージョンでは、一度に1つのテーブルのみエクスポート可能です。

**Q3: カラムの順序を変更できますか？**
A: カラム順序フィールドで数値を変更することで順序を調整できます。

**Q4: 既存のデータベースからテーブル定義をインポートできますか？**
A: 現在のバージョンではインポート機能はありません。手動で入力してください。

**Q5: プロジェクトコードは後から変更できますか？**
A: はい、プロジェクト編集画面でプロジェクトコードを変更できます。ただし、重複しないユニークな値である必要があります。

**Q6: H2データベースのデータは永続化されますか？**
A: 開発環境で使用されるH2データベースはインメモリのため、アプリケーション再起動時にデータは失われます。本番環境ではPostgreSQLを使用してデータが永続化されます。

**Q7: 複数人で同時に使用できますか？**
A: 技術的には可能ですが、現在のバージョンでは排他制御機能がないため、同時編集時にデータの整合性が保証されません。

## 11. システム管理者向け情報

### 11.1 環境設定
- 開発環境: H2データベース（インメモリ）
- 本番環境: PostgreSQL/Supabase
- アプリケーションサーバー: Spring Boot (Tomcat)
- ポート: 8080（デフォルト）

### 11.2 ログ確認
- アプリケーションログで処理状況を確認可能
- エラー発生時はサーバーログを確認してください

### 11.3 バックアップ
- 本番環境のデータベースは定期的にバックアップを取得してください
- Supabase使用時は自動バックアップ機能を活用してください

## 12. お問い合わせ

システムに関するお問い合わせは、システム管理者までご連絡ください。